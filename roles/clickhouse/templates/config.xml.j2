<?xml version="1.0"?>
<config>
    <!-- Logging configuration -->
    <logger>
        <level>information</level>
        <console>1</console>
        <errorlog>/var/log/clickhouse-server/clickhouse-server.err.log</errorlog>
        <log>/var/log/clickhouse-server/clickhouse-server.log</log>
        <size>1000M</size>
        <count>10</count>
    </logger>

    <!-- HTTP port for ClickHouse HTTP interface -->
    <http_port>8123</http_port>
    
    <!-- TCP port for native ClickHouse client -->
    <tcp_port>9000</tcp_port>
    
    <!-- MySQL compatibility port -->
    <mysql_port>9004</mysql_port>
    
    <!-- PostgreSQL compatibility port -->
    <postgresql_port>9005</postgresql_port>
    
    <!-- Interserver HTTP port for replication -->
    <interserver_http_port>{{ clickhouse_interserver_port }}</interserver_http_port>
    
    <!-- Listen on all interfaces -->
    <listen_host>::</listen_host>
    <listen_host>0.0.0.0</listen_host>
    
    <!-- Max connections -->
    <max_connections>{{ clickhouse_max_connections }}</max_connections>
    
    <!-- Max concurrent queries -->
    <max_concurrent_queries>{{ clickhouse_max_concurrent_queries }}</max_concurrent_queries>
    
    <!-- Memory limits -->
    <max_server_memory_usage>0</max_server_memory_usage>
    <max_server_memory_usage_to_ram_ratio>0.9</max_server_memory_usage_to_ram_ratio>
    
    <!-- Uncompressed cache size -->
    <uncompressed_cache_size>8589934592</uncompressed_cache_size>
    
    <!-- Mark cache size -->
    <mark_cache_size>5368709120</mark_cache_size>
    
    <!-- Path configuration -->
    <path>/var/lib/clickhouse/</path>
    <tmp_path>/var/lib/clickhouse/tmp/</tmp_path>
    <user_files_path>/var/lib/clickhouse/user_files/</user_files_path>
    <format_schema_path>/var/lib/clickhouse/format_schemas/</format_schema_path>
    
    <!-- Users configuration -->
    <users_config>users.xml</users_config>
    
    <!-- Default profile settings -->
    <profiles>
        <default>
            <max_memory_usage>10000000000</max_memory_usage>
            <use_uncompressed_cache>0</use_uncompressed_cache>
            <load_balancing>random</load_balancing>
        </default>
        
        <readonly>
            <readonly>1</readonly>
        </readonly>
    </profiles>
    
    <!-- Quotas -->
    <quotas>
        <default>
            <interval>
                <duration>3600</duration>
                <queries>0</queries>
                <errors>0</errors>
                <result_rows>0</result_rows>
                <read_rows>0</read_rows>
                <execution_time>0</execution_time>
            </interval>
        </default>
    </quotas>
    
    <!-- Default database -->
    <default_database>default</default_database>
    
    <!-- Remote servers configuration (for clustering) -->
    <remote_servers incl="clickhouse_remote_servers">
        <test_shard_localhost>
            <shard>
                <replica>
                    <host>localhost</host>
                    <port>9000</port>
                </replica>
            </shard>
        </test_shard_localhost>
    </remote_servers>
    
    <!-- Macros for replication -->
    <macros incl="macros" optional="true"/>
    
    <!-- ZooKeeper configuration (optional) -->
    <zookeeper incl="zookeeper-servers" optional="true"/>
    
    <!-- Compression settings -->
    <compression incl="clickhouse_compression">
        <case>
            <method>lz4</method>
        </case>
    </compression>
    
    <!-- Networking -->
    <networks incl="networks_config">
        <ip>::/0</ip>
    </networks>
    
    <!-- Query log -->
    <query_log>
        <database>system</database>
        <table>query_log</table>
        <partition_by>toYYYYMM(event_date)</partition_by>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
    </query_log>
    
    <!-- Part log -->
    <part_log>
        <database>system</database>
        <table>part_log</table>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
    </part_log>
    
    <!-- Enable metric log -->
    <metric_log>
        <database>system</database>
        <table>metric_log</table>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
        <collect_interval_milliseconds>1000</collect_interval_milliseconds>
    </metric_log>
    
    <!-- Text log -->
    <text_log>
        <database>system</database>
        <table>text_log</table>
        <flush_interval_milliseconds>7500</flush_interval_milliseconds>
    </text_log>
    
    <!-- Timezone -->
    <timezone>UTC</timezone>
    
    <!-- TCP keep alive -->
    <tcp_keep_alive_timeout>0</tcp_keep_alive_timeout>
    
    <!-- Settings -->
    <merge_tree>
        <max_suspicious_broken_parts>5</max_suspicious_broken_parts>
    </merge_tree>
    
    <distributed_ddl>
        <path>/clickhouse/task_queue/ddl</path>
    </distributed_ddl>
    
    <!-- Format schemas -->
    <format_schema_path>/var/lib/clickhouse/format_schemas/</format_schema_path>
</config>